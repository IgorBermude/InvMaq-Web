{% extends "base.html" %}
{% block content %}
<div class="mb-2 d-flex gap-2 mt-4">
  <a href="/report/maquinas" class="btn btn-success">
    <i class="bi bi-filetype-pdf me-1"></i> Exportar PDF
  </a>
  <a href="/report/componentes" class="btn btn-success">
    <i class="bi bi-filetype-pdf me-1"></i> Exportar PDF de Componentes
  </a>
  <a href="/maquinas/add" class="btn btn-primary ms-auto">
    <i class="bi bi-plus-lg me-1"></i> Adicionar
  </a>
</div>

<table class="table table-striped">
  <thead>
    <tr>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'linha' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=linha&direcao={{ toggled }}" class="text-decoration-none">
          Linha {% if ordenar_por == 'linha' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'nome' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=nome&direcao={{ toggled }}" class="text-decoration-none">
          Nome {% if ordenar_por == 'nome' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'usuario' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=usuario&direcao={{ toggled }}" class="text-decoration-none">
          Usuário {% if ordenar_por == 'usuario' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'setor' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=setor&direcao={{ toggled }}" class="text-decoration-none">
          Setor {% if ordenar_por == 'setor' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'andar' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=andar&direcao={{ toggled }}" class="text-decoration-none">
          Andar {% if ordenar_por == 'andar' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'ip' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=ip&direcao={{ toggled }}" class="text-decoration-none">
          IP {% if ordenar_por == 'ip' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'mac' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=mac&direcao={{ toggled }}" class="text-decoration-none">
          Endereço MAC {% if ordenar_por == 'mac' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'ponto' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=ponto&direcao={{ toggled }}" class="text-decoration-none">
          Ponto {% if ordenar_por == 'ponto' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>
        {% set toggled = 'asc' %}
        {% if ordenar_por == 'comentario' and direcao == 'asc' %}{% set toggled = 'desc' %}{% endif %}
        <a href="/?ordenar_por=comentario&direcao={{ toggled }}" class="text-decoration-none">
          Comentário {% if ordenar_por == 'comentario' %}{% if direcao == 'desc' %}▼{% else %}▲{% endif %}{% endif %}
        </a>
      </th>
      <th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% if maquinas %}
  {% for m in maquinas %}
    <tr>
      <td>{{ m.linha }}</td>
      <td>{{ m.nome }}</td>
      <td>{{ m.usuario }}</td>
      <td>{{ m.setor }}</td>
      <td>{{ m.andar }}</td>
      <td>{{ m.ip }}</td>
      <td>{{ m.mac }}</td>
      <td>{{ m.ponto }}</td>
      <td>{{ m.comentario }}</td>
      <td class="text-nowrap" style="min-width: 40px;">
        <div class="d-grid gap-1">
          <a href="/maquinas/edit/{{ m.id }}" class="btn btn-sm btn-warning w-100 rounded-pill" aria-label="Editar" title="Editar">
            <i class="bi bi-pencil-square"></i>
            Editar
          </a>
          <a href="/historico?maquina={{ m.id }}" class="btn btn-sm btn-info text-white w-100 rounded-pill" aria-label="Histórico" title="Histórico">
            <i class="bi bi-clock-history"></i>
            Histórico
          </a>
          <a href="/maquinas/delete/{{ m.id }}" class="btn btn-sm btn-danger w-100 rounded-pill" onclick="return confirm('Tem certeza que deseja excluir esta máquina?');" aria-label="Excluir" title="Excluir">
            <i class="bi bi-trash"></i>
            Excluir
          </a>
        </div>
      </td>
    </tr>
  {% endfor %}
  {% else %}
    <tr>
      <td colspan="10" class="text-center">Nenhuma máquina cadastrada.</td>
    </tr>
  {% endif %}
  </tbody>
</table>
{% endblock %}
